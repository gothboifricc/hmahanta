<!doctype html>
<html lang="en">
  <head>
    <title>HM &mdash; Blog Posts</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
    
    <meta name="description" content="">
    <meta name="keywords" content="html, css, javascript, jquery">
    <meta name="author" content="">

    <link rel="stylesheet" href="css/vendor/icomoon/style.css">
    <link rel="stylesheet" href="css/vendor/owl.carousel.min.css">
    <link rel="stylesheet" href="css/vendor/aos.css">
    <link rel="stylesheet" href="css/vendor/animate.min.css">
    <link rel="stylesheet" href="css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="css/vendor/jquery.fancybox.min.css">
    

    <!-- Theme Style -->
    <link rel="stylesheet" href="css/style.css">

  </head>
  <body data-spy="scroll" data-target=".site-nav-target" data-offset="200">

    <nav class="unslate_co--site-mobile-menu">
      <div class="close-wrap d-flex">
        <a href="#" class="d-flex ml-auto js-menu-toggle">
          <span class="close-label">Close</span>
          <div class="close-times">
            <span class="bar1"></span>
            <span class="bar2"></span>
          </div>
        </a>
      </div>
      <div class="site-mobile-inner"></div>
    </nav>


    <div class="unslate_co--site-wrap">

      <div class="unslate_co--site-inner">

        <div class="lines-wrap">
          <div class="lines-inner">
            <div class="lines"></div>
          </div>
        </div>
        <!-- END lines -->
      
      <nav class="unslate_co--site-nav site-nav-target">

        <div class="container">
        
          <div class="row align-items-center justify-content-between text-left">
            <div class="col-md-5 text-right">
              <ul class="site-nav-ul js-clone-nav text-left d-none d-lg-inline-block">
                <li class="has-children">
                  <a href="index.html#home-section" class="nav-link">Home</a>
                  <!-- <ul class="dropdown">
                    <li>
                      <a href="index.html">Hero Image BG</a>
                    </li>
                    <li>
                      <a href="index-video.html">Video BG</a>
                    </li>
                    <li>
                      <a href="index-hero-slider.html">Hero Slider</a>
                    </li>
                    <li>
                      <a href="index-sidebar-menu.html">Sidebar Menu</a>
                    </li>
                    <li>
                      <a href="index-right-menu.html">Right Menu</a>
                    </li>
                  </ul> -->
                  <!-- Compare above and below blocks of code -->
                </li>
                <li><a href="index.html#portfolio-section" class="nav-link">Portfolio</a></li>
                <li><a href="index.html#about-section" class="nav-link">About</a></li>
                <!-- <li><a href="index.html#services-section" class="nav-link">Services</a></li> -->
              </ul>
            </div>
            <div class="site-logo pos-absolute">
              <a href="index.html" class="unslate_co--site-logo">Datahoot<br>Analytics<span>.</span></a>
            </div>
            <div class="col-md-5 text-right text-lg-left">
              <ul class="site-nav-ul js-clone-nav text-left d-none d-lg-inline-block">
                <li><a href="index.html#skills-section" class="nav-link">Skills</a></li>
                <!-- <li><a href="index.html#testimonial-section" class="nav-link">Testimonial</a></li> -->
                <li><a href="index.html#journal-section" class="nav-link active">Posts</a></li>
                <li><a href="index.html#contact-section" class="nav-link">Contact</a></li>
              </ul>

              <ul class="site-nav-ul-none-onepage text-right d-inline-block d-lg-none">
                <li><a href="#" class="js-menu-toggle">Menu</a></li>
              </ul>

            </div>
          </div>
        </div>

      </nav>
      <!-- END nav -->

      <div class="cover-v1 jarallax overlay" style="background-image: url('images/blogpages/mainbg.jpg');">
        <div class="container">
          <div class="row align-items-center">
              
            <div class="col-md-8 mx-auto text-center">
              <h1 class="blog-heading" data-aos="fade-up" data-aos-delay="0">Common Table Expressions (CTEs) & Window Functions</h1>
              <div class="post-meta" data-aos="fade-up" data-aos-delay="100">SQL &bullet; October 10, 2024</div>
            </div>

          </div>
        </div>


        <!-- dov -->
        <a href="#blog-single-section" class="mouse-wrap smoothscroll">
          <span class="mouse">
            <span class="scroll"></span>
          </span>
          <span class="mouse-label">Scroll</span>
        </a>

      </div>
      <!-- END .cover-v1 -->

      <div class="unslate_co--section" id="blog-single-section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-9">
              <h3 class="mb-4">Common Table Expressions (CTEs)</h3>
              <p> A Common Table Expression (CTE) is a temporary result set that is defined within a SQL query to simplify complex operations. CTEs are created using the WITH keyword. They’re especially useful for organising queries that would otherwise be lengthy or difficult to understand if written all at once. We can think of it like taking a big problem and breaking it down into smaller steps. </p>
              <!-- <p><img src="images/work_9_a_md.jpg" alt="Image" class="img-fluid"></p> -->
              <h3 class="mb-4">Window Functions</h3>
              <p>Window functions are functions that let you do calculations in SQL across a set of rows (hence the word 'window', means that it performs the operation over a 'window' of rows) that are related to each individual row without grouping them together. Window functions use the OVER clause to define the 'window' of rows for each calculation.</p>
              <p>Some Window Functions are - </p>
              <p>ROW_NUMBER(), RANK(), DENSE_RANK() etc.</p>
              <p>(Note that some aggregate functions like SUM() can be used as Window Functions as well.)</p>
              
              <h3 class="mb-4">Interview Question</h3>
              <p>Let us understand these concepts with the help of an actual interview question asked by Uber:</p>
              <p>Assume you are given the table below on Uber transactions made by users. Write a query to obtain the third transaction of every user. Output the user id, spend and transaction date (Refer to transactions table and the example output below.)</p>
              <p><img src="images/posts/p3/t.jpg" alt="Image" class="img-fluid"></p>
              <br>
              
              <h3 class="mb-4">Solution</h3>
              <p>WITH temp_table AS <br>
                (<br>
                SELECT user_id, spend, transaction_date,<br>
                DENSE_RANK() OVER (PARTITION BY user_id ORDER BY transaction_date) AS ranked_id<br>
                FROM transactions<br>
                )<br><br>
                SELECT temp_table.user_id, temp_table.spend, temp_table.transaction_date<br>
                FROM temp_table<br>
                WHERE temp_table.ranked_id = 3;
              </p><br>

              <h3 class="mb-4">Explanation</h3>
              <p>This query uses a CTE to rank user transactions by date and filter results based on the rank. Here's how it works:</p>
              <p>» WITH temp_table (CTE):<br>
                The 'WITH' clause creates a temporary result set (CTE) 'temp_table' that assigns a rank to each transaction for every user_id using the DENSE_RANK() window function.</p>
              <p>» DENSE_RANK() (Window Function):<br>
                This window function assigns ranks starting from 1. In this query, we want to select the third transaction (rank 3) for each user. RANK() could work for users with no tied transactions ( but it’s possible that users could make multiple transactions on the same date. If we used RANK(), any ties in transaction dates would cause skipped ranks), however, DENSE_RANK() is more reliable as it prevents gaps in the ranking, ensuring that the third transaction is always captured.</p>
              <p>» PARTITION BY user_id:<br>
                This means that the ranking is done separately for each user, creating a ranking for their transactions only.</p>
              <p>» ORDER BY transaction_date:<br>
                It ensures that the transactions are ranked in the order of the date they occurred. Making sure that the 3rd transaction is indeed the 3rd transaction for the customer.</p>
              <p>» The rest of the query (main query) is very simple and involves the use of clauses like SELECT, FROM, and WHERE.</p>

              <h3 class="mb-4">Possible Use Case</h3>
              <p>This type of query can be useful in real life scenarios where one would need to analyse the third interaction/transaction of each user. For example, in e-commerce, this might help in understanding customer loyalty by examining the user's behavior after their third purchase.</p>


              <p>This question was obtained from this excellent website created by one of my mentors. Nick Singh, here's the link to the site:</p>
              <p><a href="https://datalemur.com/">Data Lemur</a></p>
              <p>It contains many actual interview questions asked by prominent companies like Uber, Facebook, Tesla etc. It has helped me a lot during my data analytics journey.</p>
              <p><em>Happy Learning!</em></p>
              <!-- <div class="pt-5 categories_tags ">
                <p>Categories:  <a href="#">WebScraping</a>, <a href="#">Data Analytics</a> , <a href="#">Data Science</a> 
                  <br>Tags: <a href="#">#html</a>, <a href="#">#trends</a></p>
              </div> -->

              <div class="post-single-navigation d-flex align-items-stretch">
                <a href="post2.html" class="mr-auto w-40 pr-4">
                  <span class="d-block">Previous Post</span>
                  Modules in Python: import and from import
                </a>
                <a href="post4.html" class="ml-auto w-40 text-right pl-4">
                  <span class="d-block">Next Post</span>
                  Confidence Level vs. Confidence Interval
                </a>
                <!-- change w- in class above to change hover width of link -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section-heading-wrap text-center mb-5">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-7 ftco-animate text-center">
              <p class="gsap-reveal"><a href="https://forms.gle/3kLF4kd8KVgpZFdU6" class="btn btn-outline-pill btn-custom-light">LEAVE A MESSAGE</a></p>
            </div>
          </div>
          <ul class="ftco-footer-social list-unstyled d-flex justify-content-center align-items-center mb-0">
            <li class="ftco-animate normal-txt">Find me on: </li>
            <li class="ftco-animate"><a href="https://www.youtube.com/@RishabhMishraOfficial"><span class="icon-github"></span></a></li>
            <li class="ftco-animate"><a href="https://www.linkedin.com/in/rishabhnmishra/"><span class="icon-linkedin"></span></a></li>
          </ul>
          <br>
        </div>
      </div>
      
      </div> 

      <footer class="unslate_co--footer unslate_co--section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-7">
              
              <div class="footer-site-logo"><a href="#">HM<span>.</span></a></div>

              <ul class="footer-site-social">
                <li><a href="www.linkedin.com/in/jagjit-k-55b028256">LinkedIn</a></li>
                <li><a href="https://github.com/gothboifricc">Github</a></li>
              </ul>

              <p class="site-copyright">
                
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script> All rights reserved | This template is made with <i class="icon-heart"
                  aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              
              </p>

            </div>
          </div>
        </div>
      </footer>

      
    </div>

    <!-- Loader -->
    <div id="unslate_co--overlayer"></div>
    <div class="site-loader-wrap">
      <div class="site-loader"></div>
    </div>

    <script src="js/scripts-dist.js"></script>
    <script src="js/main.js"></script>

  </body>
</html>